define(["jquery"],function(a){var b=null,c=null,d=null,e=/answer\[(\d+)\]/,f=function(d){var f=e.exec(d.attr("name"))[1];if(""!==d.val().trim()){var g=c.ImageExporter.molToDataUrl(d.val(),"image/png",b.getDisplaySettings());a("#fgroup_id_answeroptions_"+f).find(".marvin-image:first").attr("src",g),d.trigger("change")}};return{initedit:function(g){a(document).ready(function(){d=g.wsurl.endsWith("/")?g.wsurl:g.wsurl+"/",window.MarvinJSUtil.getEditor(g.editorid).then(function(c){if(b=c,g.defaultsettings){var d=window.JSON.parse(g.defaultsettings);b.setDisplaySettings(d)}b.importStructure("mol",a("input[name=answer\\[0\\]]").val()),a("body").on("click","input.id_insert",function(){var c=a(this).attr("id").replace("id_insert_","");b.exportStructure("mol").then(function(b){var d=a("input[name=answer\\["+c+"\\]]").val(b).trigger("change");f(d)})}),b.on("molchange",function(){a("input.mol-answer").trigger("change")}),a("body").on("click","input.id_view",function(){var c=a(this).attr("id").replace("id_view_",""),d=a("input[name=answer\\["+c+"\\]]").val();b.importStructure("mol",d)}),a("body").on("click","input.id_delete",function(){var b=a(this).attr("id").replace("id_delete_","");a("input[name=answer\\["+b+"\\]]").val("").trigger("change")}),a("body").on("change","input.mol-answer",function(){var b=e.exec(a(this).attr("name"))[1];""===a(this).val().trim()?(a("#id_view_"+b+", #id_delete_"+b).attr("disabled",!0),a("#fgroup_id_answeroptions_"+b).find(".marvin-image:first").attr("src","")):a("#id_view_"+b+", #id_delete_"+b).attr("disabled",!1)}),a("#id_marvinsettingsget").click(function(){a("#id_marvinsettings").val(window.JSON.stringify(b.getDisplaySettings())).trigger("change")}),a("body").on("change textInput input","#id_marvinsettings",function(){""!==a(this).val().trim()?a("#id_marvinsettingsset").attr("disabled",!1):a("#id_marvinsettingsset").attr("disabled",!0)}),a("#id_marvinsettingsset").click(function(){var c=a("#id_marvinsettings").val();if(c.trim())try{var d=window.JSON.parse(c);b.setDisplaySettings(d)}catch(e){window.console.log(e)}}),a("#id_marvinsettings").trigger("change"),""!==a("#id_marvinsettings").val().trim()&&a("#id_marvinsettingsset").trigger("click")}),window.MarvinJSUtil.getPackage(g.editorid).then(function(b){c=b,a(".mol-answer").each(function(){f(a(this)),a(this).trigger("change")})})})},initquestion:function(c){a(document).ready(function(){window.MarvinJSUtil.getEditor(c.editorid).then(function(d){if(b=d,c.defaultsettings){var e=window.JSON.parse(c.defaultsettings);b.setDisplaySettings(e)}b.on("molchange",function(){b.isEmpty()||b.exportStructure("mol").then(function(a){f.val(a)})});var f=a(document.getElementById(c.answerinputid));""!==f.val().trim()&&b.importStructure("mol",f.val());var g=a("#"+c.editorid);g.hasClass("correct")?g.contents().find(".mjs-canvas").css("background-color","#dff0d8"):g.hasClass("incorrect")?g.contents().find(".mjs-canvas").css("background-color","#f2dede"):g.hasClass("partiallycorrect")&&g.contents().find(".mjs-canvas").css("background-color","#fcf8e3")})})}}});